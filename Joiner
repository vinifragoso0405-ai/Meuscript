-- [[ KALIUX HUB - INSTANCE ID FIX ]] --
local HttpService = game:GetService("HttpService")
local TeleportService = game:GetService("TeleportService")
local Players = game:GetService("Players")

local URL = "https://meu-joiner-default-rtdb.firebaseio.com/.json"
local currentJob = ""
local currentPlace = 18260270114 -- ID Padr√£o definido para evitar nil

-- UI KALIUX HUB
local sg = Instance.new("ScreenGui", game.CoreGui)
sg.Name = "KALIUX Hub"

local Main = Instance.new("Frame", sg)
Main.Size = UDim2.new(0, 260, 0, 130)
Main.Position = UDim2.new(0.5, -130, 0.2, 0)
Main.BackgroundColor3 = Color3.fromRGB(15, 15, 15)
Instance.new("UICorner", Main)

local Status = Instance.new("TextLabel", Main)
Status.Size = UDim2.new(1, 0, 0, 30)
Status.Text = "BUSCANDO BOT..."
Status.TextColor3 = Color3.fromRGB(255, 255, 255)
Status.BackgroundTransparency = 1

local btn = Instance.new("TextButton", Main)
btn.Name = "JoinButton"
btn.Size = UDim2.new(0, 220, 0, 40)
btn.Position = UDim2.new(0.5, -110, 0.5, -10)
btn.Text = "AGUARDANDO"
btn.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
btn.TextColor3 = Color3.fromRGB(200, 200, 200)
btn.Font = Enum.Font.GothamBold
Instance.new("UICorner", btn)

local Discord = Instance.new("TextLabel", Main)
Discord.Size = UDim2.new(1, 0, 0, 20)
Discord.Position = UDim2.new(0, 0, 0.85, 0)
Discord.Text = "discord.gg/yDAcTrPvTD"
Discord.TextColor3 = Color3.fromRGB(114, 137, 218)
Discord.BackgroundTransparency = 1

-- FUN√á√ÉO DE TELEPORTE VIA INSTANCE ID
btn.MouseButton1Click:Connect(function()
    if currentJob ~= "" then
        btn.Text = "CONECTANDO..."
        btn.BackgroundColor3 = Color3.fromRGB(0, 150, 0)
        
        -- Teleporte usando InstanceId (Job-ID)
        local success, err = pcall(function()
            TeleportService:TeleportToPlaceInstance(tonumber(currentPlace), tostring(currentJob), Players.LocalPlayer)
        end)
        
        if not success then
            btn.Text = "ERRO NO ID!"
            warn("KALIUX: Falha no teleporte: " .. tostring(err))
            task.wait(1.5)
            btn.Text = "ENTRAR AGORA"
            btn.BackgroundColor3 = Color3.fromRGB(200, 0, 0)
        end
    else
        btn.Text = "SEM SERVIDOR"
        task.wait(1)
        btn.Text = "AGUARDANDO"
    end
end)

-- MONITORAMENTO DO FIREBASE (Sincronizado com KALIUX Notifier)
task.spawn(function()
    while task.wait(1.5) do
        local success, response = pcall(function()
            return game:HttpGet(URL)
        end)
        
        if success and response then
            local data = HttpService:JSONDecode(response)
            -- Verifica se o JobId recebido √© novo e v√°lido
            if data and data.jobId and data.jobId ~= currentJob then
                currentJob = tostring(data.jobId):gsub("%s+", "") -- Remove espa√ßos extras
                currentPlace = data.placeId or 18260270114
                
                Status.Text = "üìç SERVER DETECTADO"
                btn.Text = "ENTRAR AGORA"
                btn.BackgroundColor3 = Color3.fromRGB(200, 0, 0)
                btn.TextColor3 = Color3.fromRGB(255, 255, 255)
            end
        end
    end
end)
